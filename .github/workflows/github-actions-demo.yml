name: build_models

on: 
    pull_request:
        branches: ["main"]
    
    workflow_dispatch:

env:
    DBT_PROFILES_DIR: ./
    
    SNOWFLAKE_ACCOUNT:   ${{ secrets.SNOWFLAKE_ACCOUNT }}
    SNOWFLAKE_USERNAME: ${{ secrets.SNOWFLAKE_USERNAME }}
    SNOWFLAKE_PASSWORD: ${{ secrets.SNOWFLAKE_PASSWORD }}
    DBT_SNOWFLAKE_ROLE: ACCOUNTADMIN
    
    DBT_SNOWFLAKE_DATABASE: DEV_SANDBOX
    DBT_SNOWFLAKE_WAREHOUSE: DEV_WH
    DBT_SNOWFLAKE_SCHEMA: RTZONEVA 
jobs:
    build-and-deploy:
        runs-on: ubuntu-latest
            # DBT_PROFILES_DIR: ./
            
            # DBT_SNOWFLAKE_ACCOUNT: "{{ env_var('DBT_SNOWFLAKE_ACCOUNT') }}"
            
            # DBT_SNOWFLAKE_USERNAME: ${{ secrets.DBT_SNOWFLAKE_USERNAME }}
            # DBT_SNOWFLAKE_PW: ${{ secrets.DBT_SNOWFLAKE_PW }}
            # DBT_SNOWFLAKE_ROLE: ${{ secrets.DBT_SNOWFLAKE_ROLE }}
            
            # DBT_SNOWFLAKE_DATABASE: "{{ env_var('DBT_SNOWFLAKE_DATABASE') }}"
            # DBT_SNOWFLAKE_WAREHOUSE: "{{ env_var('DBT_SNOWFLAKE_WAREHOUSE') }}"
            # DBT_SNOWFLAKE_SCHEMA: "{{ env_var('DBT_SNOWFLAKE_SCHEMA') }}" 

        steps:
        - name: Check out
          uses: actions/checkout@master
    
        - name: Setup Python
          uses: actions/setup-python@v4
          with: 
            python-version: "3.9"

        - name: Install dependencies
          run: |
            pip3 install dbt-snowflake
            dbt deps
         
        - name: Dump GITHUB_CONTEXT
          run: echo ${{ github.workspace }}

        - name: Check files
          run: dbt debug
        
        # dbt related commands here - run use --target prod/dev to run for specific environments
        # - name: Run dbt models
        #   run: dbt run --select cust_model

        # - name: Test dbt models
        #   run: dbt test
